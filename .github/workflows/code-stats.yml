name: Code Stats

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  generate-stats:
    runs-on: ubuntu-latest
    steps:
      # Checkout ä»£ç 
      - name: Checkout code
        uses: actions/checkout@v3

      # è®¾ç½® Git é…ç½®
      - name: Set up Git
        run: |
          git config --global user.name "Muyun2023"
          git config --global user.email "ji.mu@northeastern.edu"

      # å®‰è£…ä¾èµ–å¹¶ç»Ÿè®¡ä»£ç è¡Œæ•°
      - name: Install dependencies and count lines
        run: |
          # ä½¿ç”¨ cloc å·¥å…·ç»Ÿè®¡ä»£ç è¡Œæ•°
          sudo apt-get install -y cloc
          cloc --exclude-dir=tests --json . > code_stats.json

      # æäº¤å’Œæ¨é€ç»Ÿè®¡ç»“æœ
      - name: Commit and push code stats
        run: |
          # è¯»å–ä»£ç è¡Œæ•°å¹¶å°†å…¶è½¬ä¸º Markdown æ ¼å¼
          echo "## Code Stats" > code_stats.md
          echo "### Total Lines of Code" >> code_stats.md
          cat code_stats.json | jq '.SUM.code' >> code_stats.md
          
          # æäº¤æ›´æ–°
          git add code_stats.md
          git commit -m "ğŸ§® Update code stats"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
